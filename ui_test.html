<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Pico W PID Simulator (UI Test)</title>
    <style>
        body {
            font-family: Verdana, Arial, sans-serif;
            background: #f5f2e9;
            margin: 20px;
        }

        .card {
            background: #fff;
            border: 2px solid #222;
            padding: 12px;
            margin-bottom: 12px;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
            margin-top: 8px;
        }

        button {
            padding: 8px 12px;
            margin: 4px;
            border: 2px solid #222;
            background: #eae2d0;
        }

        button:active {
            background: #fff;
        }

        input:not([type="checkbox"]),
        select {
            padding: 6px;
            border: 2px solid #222;
            margin: 4px;
            width: 110px;
        }

        input[type="checkbox"] {
            width: auto;
            padding: 0;
            border: 0;
            margin: 0;
            vertical-align: middle;
        }
        input[type="color"] {
            appearance: none;
            -webkit-appearance: none;
            padding: 0;
            border: 2px solid #222;
            margin: 0;
            width: 28px;
            height: 20px;
            background: transparent;
        }

        canvas {
            border: 2px solid #222;
            background: #fff;
        }

        .diag-block {
            fill: #fff;
            stroke: #222;
            stroke-width: 2;
        }

        .diag-line {
            stroke: #222;
            stroke-width: 2;
            fill: none;
        }

        .diag-text {
            font-size: 12px;
            fill: #222;
        }

        .diag-title {
            font-size: 12px;
            fill: #222;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h2>Pico W PID Simulator (UI Test)</h2>
    <div class="card">
        <div><b>Status</b>: <span id="running">STOPPED</span></div>
    </div>
    <div class="card"> <svg id="control_diagram" width="1600" height="420" viewBox="0 0 1600 420">
            <defs>
                <marker id="arrow" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
                    <polygon points="0 0, 10 3.5, 0 7" fill="#222" />
                </marker>
            </defs> <!-- ========================= Main chain (aligned on y=180) ========================= --> <!-- Setpoint reg -->
            <rect id="sp_block" class="diag-block" x="20" y="145" width="140" height="75" /> <text class="diag-title" x="90" y="165" text-anchor="middle">Setpoint reg</text>
            <foreignObject x="30" y="172" width="120" height="34">
                <div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;justify-content:center;"> <input id="setpoint" value="200" style="width:80px;" /> </div>
            </foreignObject> <!-- r(t) -->
            <line id="line_r" class="diag-line" x1="160" y1="180" x2="202" y2="180" marker-end="url(#arrow)" /> <text class="diag-text" x="168" y="170">r(t)</text> <!-- Summing junction -->
            <circle id="sum_block" class="diag-block" cx="230" cy="180" r="28" /> <text class="diag-text" x="222" y="172">+</text> <text class="diag-text" x="222" y="202">-</text> <!-- e(t) -->
            <line id="line_e" class="diag-line" x1="258" y1="180" x2="290" y2="180" marker-end="url(#arrow)" /> <text class="diag-text" x="266" y="170">e(t)</text> <!-- PID controller -->
            <rect id="pid_block" class="diag-block" x="290" y="120" width="260" height="120" /> <text class="diag-title" x="420" y="148" text-anchor="middle">PID controller</text> <!-- PID inputs in one row (like reference) -->
            <foreignObject x="295" y="160" width="250" height="50">
                <div xmlns="http://www.w3.org/1999/xhtml" style="display:flex;gap:0px;justify-content:center;align-items:flex-start;font-size:12px;">
                    <div style="display:flex;flex-direction:column;align-items:center;">
                        <div>Kp</div><input id="kp" value="0.000" style="width:45px;padding:6px;margin:2px;" />
                    </div>
                    <div style="display:flex;flex-direction:column;align-items:center;">
                        <div>Ki</div><input id="ki" value="0.000" style="width:45px;padding:6px;margin:2px;" />
                    </div>
                    <div style="display:flex;flex-direction:column;align-items:center;">
                        <div>Kd</div><input id="kd" value="0.000" style="width:45px;padding:6px;margin:2px;" />
                    </div>
                    <div style="display:flex;flex-direction:column;align-items:center;">
                        <div>dT</div><input id="dt" value="0" style="width:30px;padding:6px;margin:2px;" />
                    </div>
                </div>
            </foreignObject> <!-- u(t) -->
            <line id="line_u" class="diag-line" x1="550" y1="180" x2="600" y2="180" marker-end="url(#arrow)" /> <text class="diag-text" x="555" y="170">u(t)</text> <!-- Actuator / FCE -->
            <rect id="act_block" class="diag-block" x="600" y="115" width="220" height="130" /> <text class="diag-title" x="705" y="133" text-anchor="middle">Actuator / FCE</text>
            <foreignObject x="610" y="140" width="235" height="100">
                <div xmlns="http://www.w3.org/1999/xhtml" style="font-size:12px;line-height:1.2;">

                    <label style="display:flex;align-items:center;gap:10px;margin:0 px;">
                        <input type="checkbox" id="act_inject" style="width:22px;height:22px;flex:0 0 22px;margin:0;padding:0;border:0;box-sizing:border-box;">
                        <span style="display:inline-block;line-height:22px;">Inject energy</span>
                    </label>

                    <label style="display:flex;align-items:center;gap:8px;margin:6px 0 0 0;">
                        <input type="checkbox" id="act_absorb" style="width:22px;height:22px;flex:0 0 22px;margin:0;padding:0;border:0;box-sizing:border-box;">
                        <span style="display:inline-block;line-height:22px;">Absorb energy</span>
                    </label>

                    <div style="margin-top:8px;display:flex;gap:6px;align-items:center;">
                        <span>Min</span>
                        <input id="act_min" value="-100" style="width:50px;padding:6px;margin:2px;" />
                        <span>Max</span>
                        <input id="act_max" value="100" style="width:50px;padding:6px;margin:2px;" />
                    </div>

                </div>

            </foreignObject> <!-- u1(t) -->
            <line id="line_u1" class="diag-line" x1="820" y1="180" x2="870" y2="180" marker-end="url(#arrow)" /> <text class="diag-text" x="825" y="170">u1(t)</text> <!-- Plant / Process (bigger, centered like reference) -->
            <rect id="plant_block" class="diag-block" x="870" y="110" width="360" height="215" /> <text class="diag-title" x="1050" y="128" text-anchor="middle">Plant / Process</text>
            <foreignObject x="885" y="134" width="330" height="180">
                <div xmlns="http://www.w3.org/1999/xhtml" style="font-size:12px;">
                    <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
                        <div style="font-weight:bold;">Model</div> <select id="model" style="width:240px;">
                            <option value="0">First order</option>
                            <option value="1" selected>Second order</option>
                        </select>
                    </div>
                    <div style="display:flex;gap:10px;flex-wrap:wrap;">
                        <div>Gain <input id="gain" value="2.0" style="width:50px;padding:6px;margin:2px;" /></div>
                        <div>Tau <input id="tau" value="8.0" style="width:50px;padding:6px;margin:2px;" /></div>
                        <div>Wn <input id="wn" value="1.2" style="width:50px;padding:6px;margin:2px;" /></div>
                        <div>Zeta <input id="zeta" value="0.7" style="width:50px;padding:6px;margin:2px;" /></div>
                        <div>Dead <input id="dead" value="0" style="width:50px;padding:6px;margin:2px;" /> ms</div>
                    </div>
                    <div style="border:2px solid #222;padding: 6px;margin-top: 6px;font-size: 12px;">
                        <div id="tf_text">Y(s)/U(s) = K*wn^2/(s^2+2*zeta*wn*s+wn^2) | K=5.00, wn=1.20, zeta=0.70</div>
                    </div>
                </div>
            </foreignObject> <!-- y(t) output -->
            <line id="line_y" class="diag-line" x1="1230" y1="180" x2="1370" y2="180" marker-end="url(#arrow)" /> <text class="diag-text" x="1380" y="175">y(t)</text> <!-- ========================= External disturbance (above actuator, enters from top) ========================= -->
            <rect id="dist_block" class="diag-block" x="600" y="20" width="220" height="70" /> <text class="diag-title" x="700" y="45" text-anchor="middle">External disturbance</text> <!-- disturbance path: right -> then down into plant top -->
            <line id="line_pd1" class="diag-line" x1="820" y1="55" x2="1060" y2="55" />
            <line id="line_pd2" class="diag-line" x1="1060" y1="55" x2="1060" y2="110" marker-end="url(#arrow)" /> <text class="diag-text" x="1070" y="80">p(t)</text> <!-- ========================= Sensor + feedback loop ========================= -->
            <rect id="sens_block" class="diag-block" x="600" y="320" width="220" height="70" /> <text class="diag-title" x="705" y="342" text-anchor="middle">Sensor</text>
            <rect class="diag-block" x="698" y="352" width="22" height="22" /> <text class="diag-text" x="709" y="368" text-anchor="middle">1</text> <!-- Branch from y(t) line down -->
            <line id="fb_down" class="diag-line" x1="1320" y1="180" x2="1320" y2="355" /> <!-- Into sensor from right (arrow points left) -->
            <line id="fb_into_sensor" class="diag-line" x1="1320" y1="355" x2="820" y2="355" marker-end="url(#arrow)" /> <!-- Out of sensor to the left -->
            <line id="fb_out_sensor" class="diag-line" x1="600" y1="355" x2="230" y2="355" /> <!-- Up into summing junction -->
            <line id="fb_up_to_sum" class="diag-line" x1="230" y1="355" x2="230" y2="208" marker-end="url(#arrow)" /> <text class="diag-text" x="246" y="228">y1(t)</text>
        </svg>
        <div class="controls">
            <div>Time window (s) <input id="window" value="100"></div> <button>Apply</button> <button>Start</button> <button>Stop</button> <button>Reset</button> <button>Clear Plot</button>
        </div>
    </div>
    <div class="card">
        <div style="display:flex;gap:16px;align-items:center;flex-wrap:wrap;">
            <div><b>Time</b>: <span id="time">0</span> s</div>
            <div><b>Output</b>: <span id="output">0</span> C</div>
            <div><b>Control u</b>: <span id="control">0</span></div>
            <div><b>Actuator</b>: <span id="actuator">0</span></div>
        </div>
    </div>
    <div class="card">
        <div style="display:flex;gap:12px;align-items:center;flex-wrap:wrap;justify-content:flex-start;">
            <label style="display:inline-flex;gap:6px;align-items:center;margin:0;"><input type="checkbox" id="show_sp" checked style="margin:0;">Setpoint</label>
            <input type="color" id="color_sp" value="#000000" style="margin:0;width:28px;height:20px;">
            <label style="display:inline-flex;gap:6px;align-items:center;margin:0;"><input type="checkbox" id="show_u" checked style="margin:0;">Control u</label>
            <input type="color" id="color_u" value="#9b9b9b" style="margin:0;width:28px;height:20px;">
            <label style="display:inline-flex;gap:6px;align-items:center;margin:0;"><input type="checkbox" id="show_u1" checked style="margin:0;">Actuator u1</label>
            <input type="color" id="color_u1" value="#6abf4b" style="margin:0;width:28px;height:20px;">
            <label style="display:inline-flex;gap:6px;align-items:center;margin:0;"><input type="checkbox" id="show_y" checked style="margin:0;">Output y</label>
            <input type="color" id="color_y" value="#b00000" style="margin:0;width:28px;height:20px;">
        </div>
        <canvas id="plot" width="1600" height="600"></canvas>
    </div>
    <script>
        /* UI test stub: update transfer function text only. */
        function updateTF() {
            var model = document.getElementById('model').value;
            var gain = document.getElementById('gain').value;
            var tau = document.getElementById('tau').value;
            var wn = document.getElementById('wn').value;
            var zeta = document.getElementById('zeta').value;
            var tf = '';
            if (model === '0') {
                tf = 'Y(s)/U(s) = K/(tau*s+1) | K=' + gain + ', tau=' + tau;
            } else {
                tf = 'Y(s)/U(s) = K*wn^2/(s^2+2*zeta*wn*s+wn^2) | K=' + gain + ', wn=' + wn + ', zeta=' + zeta;
            }
            document.getElementById('tf_text').textContent = tf;
        }
        document.getElementById('model').addEventListener('change', updateTF);
        document.getElementById('gain').addEventListener('input', updateTF);
        document.getElementById('tau').addEventListener('input', updateTF);
        document.getElementById('wn').addEventListener('input', updateTF);
        document.getElementById('zeta').addEventListener('input', updateTF);
        function updateColorPickers() {
            document.getElementById('color_sp').style.background = document.getElementById('color_sp').value;
            document.getElementById('color_u').style.background = document.getElementById('color_u').value;
            document.getElementById('color_u1').style.background = document.getElementById('color_u1').value;
            document.getElementById('color_y').style.background = document.getElementById('color_y').value;
        }
        document.getElementById('color_sp').addEventListener('input', updateColorPickers);
        document.getElementById('color_u').addEventListener('input', updateColorPickers);
        document.getElementById('color_u1').addEventListener('input', updateColorPickers);
        document.getElementById('color_y').addEventListener('input', updateColorPickers);
        updateTF();
        updateColorPickers();
    </script>
</body>

</html>
